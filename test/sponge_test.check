#include "sponge.h"

#include <stdio.h>
#include <string.h>

#include <check.h>

#test squeeze_IV
    // the output of the squeeze function on a just-initialized
    // sponge in Lyra2's reference SSE implementation.
    const uint8_t expected[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x08, 0xc9, 0xbc, 0xf3, 0x67, 0xe6, 0x09, 0x6a,
        0x3b, 0xa7, 0xca, 0x84, 0x85, 0xae, 0x67, 0xbb,
        0x2b, 0xf8, 0x94, 0xfe, 0x72, 0xf3, 0x6e, 0x3c,
        0xf1, 0x36, 0x1d, 0x5f, 0x3a, 0xf5, 0x4f, 0xa5,
        0x2d, 0x56, 0x47, 0x55, 0x66, 0x10, 0x9f, 0xe6,
        0x27, 0xaf, 0x2a, 0x6d, 0x2e, 0xe8, 0x66, 0xfe,
        0x68, 0x1c, 0x33, 0xac, 0x12, 0xbf, 0xa7, 0xe5,
        0x5a, 0x17, 0x6a, 0x4a, 0x05, 0xcf, 0xc2, 0x0c
    };

    uint8_t squeezed[sizeof(expected) / sizeof(uint8_t)] = {0};

    sponge_t *sponge = sponge_new();
    sponge_squeeze(sponge, squeezed, sizeof(squeezed), false);

    ck_assert(!memcmp(squeezed, expected, sizeof(expected) / sizeof(uint8_t)));
    sponge_destroy(sponge);
    return;
